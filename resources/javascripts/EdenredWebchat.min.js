class EdenredWebchat{constructor(e,t={}){this.cognigyEndpoint=e,this.params=t,this.BOTTOM_DISTANCE=70}initEdenredWebchat(e=!1){let t=document.createElement("div");t.id="newMessageIndicator",t.textContent="Nouveau message",t.style.cssText=`
            position: relative;
            height: 18px;
            margin-top: -18px;
            background: linear-gradient(0deg, rgba(220, 38, 25, 0.2), transparent);
            color: #dc2619;
            text-align: center;
            font-size: 12px;
            z-index: 1000;
        `;let i=null,r=0,n=this.waitForElm.bind(this),c=this.BOTTOM_DISTANCE,o=()=>{n("[data-cognigy-webchat-toggle]").then(e=>{document.querySelector("[data-cognigy-webchat-toggle]").addEventListener("click",function(e){n("#webchatChatHistory").then(e=>{(i=document.querySelector("#webchatChatHistory")).addEventListener("scroll",()=>{r=i.scrollTop;let e=i.scrollHeight-i.scrollTop-c<=i.clientHeight;if(e){let t=document.querySelector("#newMessageIndicator");t&&t.remove()}});let t=window.visualViewport,n=document.documentElement.clientHeight;t.addEventListener("resize",function e(){let i=t.height;if(t.width<575){let r=document.querySelector("[data-cognigy-webchat]"),c=document.querySelector(".webchat-header-bar");i<n?(r.style.cssText=`height: ${i}px; top: ${n-i}px`,c.style.cssText="padding-top: 10px;padding-bottom: 10px;"):(r.style.cssText="",c.style.cssText="")}})})})})};return initWebchat(this.cognigyEndpoint,this.params).then(e=>{o(),e.registerAnalyticsService(e=>{"webchat/incoming-message"===e.type&&i&&setTimeout(()=>{i.scrollTo({top:r});let e=i.scrollHeight-i.scrollTop-c<=i.clientHeight;e||i.insertAdjacentElement("afterend",t)},10)})})}waitForElm(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));let i=new MutationObserver(r=>{document.querySelector(e)&&(t(document.querySelector(e)),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0})})}}