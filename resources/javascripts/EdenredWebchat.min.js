class EdenredWebchat{constructor(e,t={}){this.cognigyEndpoint=e,this.params=t,this.BOTTOM_DISTANCE=70,this.hideInput=!1}initEdenredWebchat(e=!1){let t=document.createElement("div");t.id="newMessageIndicator",t.textContent="Nouveau message",t.style.cssText=`
            position: relative;
            height: 18px;
            margin-top: -18px;
            background: linear-gradient(0deg, rgba(220, 38, 25, 0.2), transparent);
            color: #dc2619;
            text-align: center;
            font-size: 12px;
            z-index: 1000;
        `;let i=null,n=0,r=this.waitForElm.bind(this),s=this.BOTTOM_DISTANCE,l=()=>{r("[data-cognigy-webchat-toggle]").then(e=>{document.querySelector("[data-cognigy-webchat-toggle]").addEventListener("click",function(e){r("#webchatChatHistory").then(e=>{(i=document.querySelector("#webchatChatHistory")).addEventListener("scroll",()=>{n=i.scrollTop;let e=i.scrollHeight-i.scrollTop-s<=i.clientHeight;if(e){let t=document.querySelector("#newMessageIndicator");t&&t.remove()}});let t=window.visualViewport,r=document.documentElement.clientHeight;t.addEventListener("resize",function e(){let i=t.height;if(t.width<575){let n=document.querySelector("[data-cognigy-webchat]"),s=document.querySelector(".webchat-header-bar");i<r?(n.style.cssText=`height: ${i}px; top: ${r-i}px`,s.style.cssText="padding-top: 10px;padding-bottom: 10px;"):(n.style.cssText="",s.style.cssText="")}})})})})};return initWebchat(this.cognigyEndpoint,this.params).then(e=>{l(),e.registerAnalyticsService(e=>{if("webchat/open"==e.type&&this.hideInputField(this.hideInput),"webchat/outgoing-message"===e.type&&!0==this.hideInput&&this.hideInputField(!1),"webchat/incoming-message"===e.type){let{payload:r}=e,{text:l,data:o}=r;i&&setTimeout(()=>{i.scrollTo({top:n});let e=i.scrollHeight-i.scrollTop-s<=i.clientHeight;e||i.insertAdjacentElement("afterend",t)},10),o?.hideInput&&this.hideInputField(!0)}})})}waitForElm(e){return new Promise(t=>{if(document.querySelector(e))return t(document.querySelector(e));let i=new MutationObserver(n=>{document.querySelector(e)&&(t(document.querySelector(e)),i.disconnect())});i.observe(document.body,{childList:!0,subtree:!0})})}hideInputField(e){this.waitForElm(".webchat-input").then(t=>{try{e?t.style.display="none":t.style.display="block",this.hideInput=e}catch(i){console.error(i)}})}}